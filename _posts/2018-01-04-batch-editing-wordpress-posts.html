---
layout: post
title: Batch editing WordPress posts
date: 2018-01-04 09:08:39.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags:
- oauth
- python
- wordpress
meta:
  _thumbnail_id: '3578'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '13191994842'
author:


  display_name: ngeor
  first_name: Nikolaos
  last_name: Georgiou
---
<p>TL;DR: I had some fun hacking a tiny tool to batch edit posts in my blog in order to fix syntax highlighting of code blocks.</p>
<p><!--more--></p>
<p><strong>Background and motivation</strong></p>
<p>My blog has had various incarnations over time. It's been on WordPress.com, on my own server with Jekyll and on my own server with WordPress. At some point I went full circle and returned to WordPress.com. The end result is that the various code snippets I include in my posts are not very readable. This is how old code snippets look like:</p>
<p>[caption id="attachment_3575" align="alignnone" width="693"]<img class="alignnone size-full wp-image-3575" src="{{ site.baseurl }}/assets/2018-01-04-08_16_46-extending-nunit_-nunit-companion-e28093-ngeor-wordpress-com.png" alt="2018-01-04 08_16_46-Extending NUnit_ NUnit Companion – ngeor.wordpress.com.png" width="693" height="542" /> Old code snippets[/caption]</p>
<p>It's not very readable compared to the more recent posts:</p>
<p>[caption id="attachment_3576" align="alignnone" width="456"]<img class="alignnone size-full wp-image-3576" src="{{ site.baseurl }}/assets/2018-01-04-08_20_01-adding-webdriverio-tests-e28093-ngeor-wordpress-com.png" alt="2018-01-04 08_20_01-Adding WebdriverIO tests – ngeor.wordpress.com.png" width="456" height="238" /> New code snippets[/caption]</p>
<p>The reason has to do with the underlying markup. The old posts were using HTML like:</p>
<p>[code]<br />
&lt;pre class=&quot;prettyprint&quot;&gt;<br />
code goes here<br />
&lt;/pre&gt;<br />
[/code]</p>
<p>The new posts use <a href="https://en.support.wordpress.com/code/posting-source-code/">code shortcodes</a> (normally without the extra spaces):</p>
<p>[code]<br />
[ code ]<br />
code goes here<br />
[ /code ]<br />
[/code]</p>
<p>To fix this, I'd have to go through all the posts, find all code snippets, and replace the old markup with the new. Sounds like a job for a machine!</p>
<p><strong>New Year Resolutions</strong></p>
<p>Learning new things is always fun. I wanted to do a bit more Python this year, even though I never wrote anything with Python professionally. It's a language I found interesting but never had the chance to use it. The Python 2 vs 3 schism was also a deterrent. It's still annoying that search results on google take you to Python 2 results. I had the same problem when I was trying to do a hello world project with Angular, where search results appear for the old AngularJS. But, I gave it a try and I managed to put together what I wanted to achieve without much effort. I called the tool <a href="https://github.com/ngeor/wpbot">wpbot</a> and it's available on GitHub.</p>
<p><strong>WordPress.org vs WordPress.com</strong></p>
<p>Googling was confusing in this case too. Just like with Python 2 vs Python 3, I was trying to understand how to connect to the REST API of WordPress, but I got results applicable to self-hosted sites (.org). For my blog, which is on WordPress.com, there's different <a href="https://developer.wordpress.com/docs/">documentation</a>.</p>
<p><strong>OAuth</strong></p>
<p>The most difficult part was setting up OAuth (partly due to the confusion between WordPress.org and WordPress.com). The first step is to create a new <a href="https://developer.wordpress.com/apps/">WordPress.com application</a>. This will provide you with a client ID and a client secret. With the client ID and secret, it's possible to authorize the app to edit posts:</p>
<p>[caption id="attachment_3577" align="alignnone" width="492"]<img class="alignnone size-full wp-image-3577" src="{{ site.baseurl }}/assets/2018-01-04-08_49_38-authorize-wpbot.png" alt="2018-01-04 08_49_38-Authorize wpbot.png" width="492" height="505" /> Authorizing my app[/caption]</p>
<p>WordPress will then redirect to the URL of the application. Since this is a CLI tool, I launch a small web server from the tool which listens on localhost:3000 to intercept the OAuth code.</p>
<p><strong>Lessons</strong></p>
<p>I found that most of the things I used are provided by Python's standard library. I really liked the <a href="https://docs.python.org/3/library/argparse.html">argparse</a> module which is great for building CLI tools. I used also <a href="https://docs.python.org/3/library/http.server.html">http.server</a> for listening to the OAuth response and <a href="https://docs.python.org/3/library/webbrowser.html">webbrowser</a> to start the default browser on the authorization URL, all provided by the standard library.</p>
<p>I used two external modules: <a href="http://docs.python-requests.org/en/master/">requests</a> in order to call the REST API and <a href="http://requests-oauthlib.readthedocs.io/en/latest/">requests_oauthlib</a> for OAuth. I don't know if the standard library has something built-in, coding with nodeJS for so long has conditioned me to googling for a community library instead of looking at what's provided with the package :)</p>
<p>All in all, I had fun writing this tool. Visual Studio Code helps with pylint to catch obvious errors and I even had a look at writing my first unit test in Python.</p>
<p><em>Wordpress gears image source: <a href="https://pixabay.com/en/wordpress-blog-blogger-blogging-1530617/">https://pixabay.com/en/wordpress-blog-blogger-blogging-1530617/</a></em></p>
