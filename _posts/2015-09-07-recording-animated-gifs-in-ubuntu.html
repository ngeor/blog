---
layout: post
title: Recording animated gifs in ubuntu
date: 2015-09-07 07:30:00.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags: []
meta:
  _edit_last: '14213986'
  restapi_import_id: 586b47d26eba1
  original_post_id: '6'
  _wp_old_slug: '6'
  _publicize_job_id: '4016825630'
author:


  display_name: ngeor
  first_name: Nikolaos
  last_name: Georgiou
---
<p>Last week I wanted to do a small screen recording on my Ubuntu desktop and save it as an animated gif. I tried <a href="https://screentogif.codeplex.com/">ScreenToGif</a> but that didn’t work in Ubuntu, it threw an exception when I pressed the record button. I found a good solution in this <a href="http://askubuntu.com/questions/107726/how-to-create-animated-gif-images-of-a-screencast">askubuntu</a> question and I'm building on top of it to make it as easy as right clicking on a video file.<!--more--></p>
<h2 id="overview-and-software-required">Overview and software required</h2>
<p>There are three basic steps in this process:</p>
<ul>
<li><strong>Make a video recording of the screen</strong>. You’ll need <code>gtk-recordmydesktop</code> to record the video. This is a quite user friendly desktop application.</li>
<li><strong>Convert the video to JPEG files</strong>. You’ll need <code>mplayer</code> to convert the video to JPEG image files.</li>
<li><strong>Convert the JPEG files into an animated GIF</strong>. You’ll need <code>imagemagick</code> to convert the JPEG images into a single animated GIF.</li>
</ul>
<p>To install these tools, run:</p>
<p><code><br />
sudo apt-get install imagemagick mplayer gtk-recordmydesktop<br />
</code></p>
<h2 id="record-the-video">Record the video</h2>
<p>No command line kung-fu is required for this one, which is something I can’t say for the next steps. Just start the RecordMyDesktop app (installed earlier with <code>gtk-recordmydesktop</code>) and record the video. It stores it in the ogv format.</p>
<h2 id="convert-to-jpegs">Convert to JPEGs</h2>
<p>In this part, we use <code>mplayer</code> to convert the video to JPEG images. From a command line:</p>
<p><code><br />
mplayer -ao null &lt;video file name&gt; -vo jpeg:outdir=output<br />
</code></p>
<p>This command will convert the video into a series of JPEG image files and it will store them in a folder called output.</p>
<h2 id="convert-to-animated-gif">Convert to animated GIF</h2>
<p>Here we convert the JPEG images into a single animated GIF file. Run the following command:</p>
<p><code><br />
convert output/* output.gif<br />
</code></p>
<h2 id="optimizing-the-gif">Optimizing the GIF</h2>
<p>If you run the above, you’ll notice that the file size of the GIF may be a bit too large to be put on a web page.</p>
<p>There’s two things you can do:</p>
<ol>
<li>Animation Optimization</li>
<li>Resize the source JPEG images in advance</li>
</ol>
<h3 id="animation-optimization">Animation Optimization</h3>
<p>ImageMagick has some built-in capabilities that go a long way optimizing the final file size of the GIF file. To optimize an animated GIF, try out this command:</p>
<p><code><br />
convert output.gif -fuzz 10% -layers Optimize optimised.gif<br />
</code></p>
<p>If you want to read more about it:</p>
<ul>
<li><a href="http://www.imagemagick.org/Usage/anim_opt/">Animation Optimization</a></li>
<li><a href="http://www.imagemagick.org/Usage/color_basics/#fuzz">The fuzz factor</a></li>
</ul>
<h3 id="resize-the-source-jpeg-images">Resize the source JPEG images</h3>
<p>You can scale down the JPEG images without sacrificing too much readability. To convert a single JPEG file, you can use ImageMagick again:</p>
<p><code><br />
convert in.jpg -resize -resize 440x330 out.jpg<br />
</code></p>
<p>Since we have a bunch of files, some bash scripting will be needed:</p>
<p>[code]<br />
#!/bin/bash</p>
<p># input folder<br />
IN=&quot;$1&quot;</p>
<p># output folder<br />
OUTPUT=&quot;$IN-resized-440w&quot;</p>
<p>mkdir $OUTPUT<br />
for i in $(find $IN -type f); do<br />
	o=$OUTPUT/$(basename &quot;$i&quot;)<br />
	convert $i -resize 440x330 $o<br />
done<br />
[/code]</p>
<p>This script takes a JPEG folder as input and creates a new folder with all images resized.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>I like <a href="https://help.ubuntu.com/community/NautilusScriptsHowto">Nautilus scripts</a> and I think it would be great to just be able to right click on a video, “Convert to Animated GIF”, done (well it takes a while to do all the processing, but still).</p>
<p>The following is a rather naive version of such a script:</p>
<p>[code]<br />
#!/bin/bash</p>
<p># input file<br />
VIDEO=&quot;$@&quot;</p>
<p># output file<br />
OUTPUT=&quot;$@.gif&quot;</p>
<p># temporary folder<br />
TMP=/tmp/convert-video-to-gif/</p>
<p># temporary folder for jpegs<br />
TMP_JPEG=$TMP/output/</p>
<p>TMP_UNOPTIMIZED_GIF=$TMP/unoptimized.gif</p>
<p># create folder<br />
rm -rf $TMP<br />
mkdir $TMP</p>
<p>mplayer -ao null &quot;$VIDEO&quot; -vo jpeg:outdir=$TMP_JPEG<br />
convert $TMP_JPEG/* $TMP_UNOPTIMIZED_GIF<br />
convert $TMP_UNOPTIMIZED_GIF -fuzz 10% -layers Optimize $OUTPUT</p>
<p>zenity --info --text=&quot;Finished converting $VIDEO, result is at $OUTPUT&quot;<br />
[/code]</p>
<p>Note that it uses <a href="https://help.gnome.org/users/zenity/stable/">zenity</a> to display an info message when it’s all done.</p>
<p>This script will take the video <code>my-video.ogv</code> and convert it into an animated GIF named <code>my-video.ogv.gif</code>. But be aware:</p>
<ul>
<li>it has no sanity checks</li>
<li>it won’t work with filenames that contain spaces</li>
<li>it doesn’t do the JPEG resizing part</li>
</ul>
<p>Next time I’ll need an animated GIF, I might get around to writing it a bit better.</p>
