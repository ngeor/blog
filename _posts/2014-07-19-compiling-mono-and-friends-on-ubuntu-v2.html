---
layout: post
title: Compiling Mono and friends on Ubuntu, v2
date: 2014-07-19 18:00:00.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags: []
meta:
  _edit_last: '14213986'
  restapi_import_id: 586b47d26eba1
  original_post_id: '12'
  _wp_old_slug: '12'
  _publicize_job_id: '4016809544'
author:


  display_name: ngeor
  first_name: Nikolaos
  last_name: Georgiou
---
<p>This is an updated guide on how to compile mono from source on Ubuntu. This time, it’s about Ubuntu 14.04 (trusty tahr). This post covers:</p>
<ul>
<li>mono</li>
<li>xsp</li>
<li>libgdiplus</li>
<li>nuget</li>
<li>nant</li>
<li>mod_mono</li>
<li>gtksharp</li>
<li>vb.net</li>
</ul>
<p><!--more--></p>
<h2 id="assumptions">Assumptions</h2>
<ul>
<li>For simplicity, I’ve ommitted the ‘sudo’ from the parts where it is needed.</li>
<li>The source code is going to be checked out under <code>/usr/local/src</code>.</li>
<li>Installation is going to be made in <code>/usr/local</code>.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>These are the basic requirements for a build environment. Remember that <code>apt-get install</code> is supposed to be run as root.</p>
<p>[code]<br />
apt-get install git build-essential pkg-config autoconf automake libtool gettext<br />
[/code]</p>
<p>We’ll be checking out the code in <code>/usr/local/src</code>, so lets go and create that directory:</p>
<p>[code]<br />
mkdir /usr/local/src<br />
[/code]</p>
<p>After everything is installed you can delete it to save some disk space. Personally I keep it around in case I want to fetch the latest code again from upstream and rebuild.</p>
<h2 id="mono">mono</h2>
<p>First, mono itself:</p>
<p>[code]<br />
cd /usr/local/src<br />
git clone git://github.com/mono/mono.git<br />
cd mono<br />
./autogen.sh --prefix=/usr/local<br />
make get-monolite-latest<br />
make<br />
make install<br />
[/code]</p>
<h2 id="xsp">xsp</h2>
<p>XSP is a web server:</p>
<p>[code]<br />
cd /usr/local/src<br />
git clone git://github.com/mono/xsp.git<br />
cd xsp<br />
./autogen.sh --prefix=/usr/local<br />
make<br />
make install<br />
[/code]</p>
<h2 id="libgdiplus">libgdiplus</h2>
<p>libgdiplus is needed for drawing and stuff:</p>
<p>[code]<br />
cd /usr/local/src<br />
git clone https://github.com/mono/libgdiplus.git<br />
cd libgdiplus<br />
git checkout 2.10.8<br />
[/code]</p>
<p>It has some extra prerequisites:</p>
<p>[code]<br />
apt-get install libglib2.0-dev libjpeg-dev libtiff5-dev libpng12-dev libgif-dev libexif-dev libx11-dev libxrender-dev libfreetype6-dev libfontconfig1-dev<br />
[/code]</p>
<p>Now this is going to be tricky. On Ubuntu 14.04, <strong>it no longer builds without some editing of the source code</strong>. There are just two files to edit:</p>
<ul>
<li><code>src/gdiplus-private.h</code></li>
<li><code>tests/Makefile.am</code></li>
</ul>
<p>First, edit <code>src/gdiplus-private.h</code>. Instead of including the file<code>freetype/tttables.h</code>, you need to include <code>ft2build.h</code> and <code>FT_TRUETYPE_TABLES_H</code>. This is shown in the following diff:</p>
<p>[code]<br />
ngeor@mini:/usr/local/src/libgdiplus$ git diff src<br />
diff --git a/src/gdiplus-private.h b/src/gdiplus-private.h<br />
index 59edf9e..283280d 100644<br />
--- a/src/gdiplus-private.h<br />
+++ b/src/gdiplus-private.h<br />
@@ -30,7 +30,9 @@<br />
 #include &lt;stdio.h&gt;<br />
 #include &lt;math.h&gt;<br />
 #include &lt;glib.h&gt;<br />
-#include &lt;freetype/tttables.h&gt;<br />
+#include &lt;ft2build.h&gt;<br />
+#include FT_TRUETYPE_TABLES_H<br />
+<br />
[/code]</p>
<p>Then, edit the second file that is causing problems, <code>tests/Makefile.am</code>. You need to add a LIBS dependency, as shown in the following diff:</p>
<p>[code]<br />
&lt;span class=&quot;gh&quot;&gt;diff --git a/tests/Makefile.am b/tests/Makefile.am<br />
index 5b8c67c..b07da64 100644<br />
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;--- a/tests/Makefile.am<br />
&lt;/span&gt;&lt;span class=&quot;gi&quot;&gt;+++ b/tests/Makefile.am<br />
&lt;/span&gt;&lt;span class=&quot;gu&quot;&gt;@@ -1,4 +1,5 @@<br />
&lt;/span&gt; ## Makefile.am for libgdiplus/tests<br />
&lt;span class=&quot;gi&quot;&gt;+LIBS = $(GDIPLUS_LIBS)<br />
&lt;/span&gt;<br />
 INCLUDES =<br />
        -I$(top_srcdir)<br />
[/code]</p>
<p>This should be enough to make libgdiplus compile with the usual incantation:</p>
<p>[code]<br />
./autogen.sh --prefix=/usr/local<br />
make<br />
make install<br />
[/code]</p>
<h2 id="nuget-certificates">nuget certificates</h2>
<p>For every user that is going to be using NuGet, you need to import some certificates with:</p>
<p>[code]<br />
mozroots --import --sync<br />
[/code]</p>
<p>This needs to be run only once but it should be run for every user that needs nuget. That’s also the user that is running your continuous integration builds.</p>
<h2 id="nuget">nuget</h2>
<p>And now, nuget itself. Why not create a script so that nuget can be easily accessible from the command line?</p>
<p>First, download <code>nuget.exe</code> and copy it to /usr/local/bin/. Then, create the following script:</p>
<p>[code]<br />
&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;<br />
&lt;span class=&quot;nb&quot;&gt;exec &lt;/span&gt;mono &lt;span class=&quot;nv&quot;&gt;$MONO_OPTIONS&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;dirname &lt;span class=&quot;nv&quot;&gt;$0&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;/nuget.exe &lt;span class=&quot;nv&quot;&gt;$*&lt;/span&gt;<br />
[/code]</p>
<p>and save it as <code>/usr/local/bin/nuget</code>. Don’t forget to grant it execute permissions.</p>
<h2 id="nant">nant</h2>
<p>I always have some problems when it comes to <code>nant</code>. Usually something goes wrong with <code>pkg-config</code> or sometimes it defaults to using .NET 2.0. I tried two approaches here. The first one was to download the latest tarball and try to install it. The second one was to get the latest source and build it. I believe that <strong>the second option</strong> is better in the end. Here are both of them:</p>
<h3 id="first-option-use-the-latest-tarball">first option: use the latest tarball</h3>
<p>Download the latest tarball and extract it into <code>/usr/local/lib</code>. So</p>
<p>Create a shell script named <code>nant</code> and place it in <code>/usr/local/bin</code>:</p>
<p>[code]<br />
&lt;span class=&quot;c&quot;&gt;#!/bin/sh&lt;/span&gt;<br />
&lt;span class=&quot;nb&quot;&gt;exec &lt;/span&gt;mono &lt;span class=&quot;nv&quot;&gt;$MONO_OPTIONS&lt;/span&gt; /usr/local/lib/nant-0.92/bin/NAnt.exe &lt;span class=&quot;nv&quot;&gt;$*&lt;/span&gt;<br />
[/code]</p>
<p>you might need to invoke it with <code>MONO_OPTIONS=--runtime=v4.0</code></p>
<p>You’ll probably need to modify <code>NAnt.exe.config</code> too.</p>
<ul>
<li>set mono-4.5 the default
<p>[code]<br />
&lt;platform name=&quot;unix&quot; default=&quot;mono-4.5&quot;&gt;<br />
[/code]
</li>
<li>add mono-4.5 definition based on 4.0
<p>[code]<br />
&lt;framework<br />
              name=&quot;mono-4.5&quot;<br />
              family=&quot;mono&quot;<br />
              version=&quot;4.5&quot;<br />
              description=&quot;Mono 4.5 Profile&quot;<br />
              sdkdirectory=&quot;${toolDirectory}&quot;<br />
              frameworkdirectory=&quot;${toolDirectory}&quot;<br />
              frameworkassemblydirectory=&quot;${path::combine(prefix, 'lib/mono/4.5')}&quot;<br />
              clrversion=&quot;4.0.30319&quot;<br />
              clrtype=&quot;Desktop&quot;<br />
              vendor=&quot;Mono&quot;<br />
              &gt;<br />
              &lt;runtime&gt;<br />
                  &lt;probing-paths&gt;<br />
                      &lt;directory name=&quot;lib/mono/4.5&quot; /&gt;<br />
                      &lt;directory name=&quot;lib/mono/neutral&quot; /&gt;<br />
                      &lt;directory name=&quot;lib/common/4.5&quot; /&gt;<br />
                      &lt;directory name=&quot;lib/common/neutral&quot; /&gt;<br />
                  &lt;/probing-paths&gt;<br />
                  &lt;modes&gt;<br />
                      &lt;auto&gt;<br />
                          &lt;engine program=&quot;${path::combine(prefix, 'bin/mono')}&quot; /&gt;<br />
                      &lt;/auto&gt;<br />
                      &lt;strict&gt;<br />
                          &lt;engine program=&quot;${path::combine(prefix, 'bin/mono')}&quot;&gt;<br />
                              &lt;arg value=&quot;--runtime=v4.0.30319&quot; /&gt;<br />
                          &lt;/engine&gt;<br />
                      &lt;/strict&gt;<br />
                  &lt;/modes&gt;<br />
              &lt;/runtime&gt;<br />
              &lt;reference-assemblies basedir=&quot;${path::combine(prefix, 'lib/mono/4.5')}&quot;&gt;<br />
                  &lt;include name=&quot;*.dll&quot; /&gt;<br />
              &lt;/reference-assemblies&gt;<br />
              &lt;reference-assemblies basedir=&quot;${path::combine(prefix, 'lib/mono/4.0')}&quot;&gt;<br />
                  &lt;include name=&quot;*.dll&quot; /&gt;<br />
              &lt;/reference-assemblies&gt;<br />
              &lt;reference-assemblies basedir=&quot;${path::combine(prefix, 'lib/mono/3.5')}&quot;&gt;<br />
                  &lt;include name=&quot;*.dll&quot; /&gt;<br />
              &lt;/reference-assemblies&gt;<br />
              &lt;reference-assemblies basedir=&quot;${path::combine(prefix, 'lib/mono/3.0')}&quot;&gt;<br />
                  &lt;include name=&quot;*.dll&quot; /&gt;<br />
              &lt;/reference-assemblies&gt;<br />
              &lt;reference-assemblies basedir=&quot;${path::combine(prefix, 'lib/mono/2.0')}&quot;&gt;<br />
                  &lt;include name=&quot;*.dll&quot; /&gt;<br />
              &lt;/reference-assemblies&gt;<br />
              &lt;task-assemblies&gt;<br />
                  &lt;!-- include Mono version-neutral assemblies --&gt;<br />
                  &lt;include name=&quot;extensions/mono/neutral/**/*.dll&quot; /&gt;<br />
                  &lt;!-- include Mono 2.0 specific assemblies --&gt;<br />
                  &lt;include name=&quot;extensions/mono/2.0/**/*.dll&quot; /&gt;<br />
                  &lt;!-- include .NET 2.0 specific assemblies --&gt;<br />
                  &lt;include name=&quot;extensions/common/2.0/**/*.dll&quot; /&gt;<br />
              &lt;/task-assemblies&gt;<br />
              &lt;tool-paths&gt;<br />
                  &lt;directory name=&quot;${toolDirectory}&quot; /&gt;<br />
                  &lt;directory name=&quot;${path::combine(prefix, 'lib/mono/3.5')}&quot; /&gt;<br />
                  &lt;directory name=&quot;${path::combine(prefix, 'lib/mono/2.0')}&quot; /&gt;<br />
                  &lt;directory name=&quot;${path::combine(prefix, 'lib/mono/1.0')}&quot; /&gt;<br />
                  &lt;!-- unmanaged tools --&gt;<br />
                  &lt;directory name=&quot;${prefix}/bin&quot; /&gt;<br />
              &lt;/tool-paths&gt;<br />
              &lt;project&gt;<br />
                  &lt;if test=&quot;${not pkg-config::exists('mono')}&quot;&gt;<br />
                      &lt;fail&gt;Unable to locate 'mono' module using pkg-config. Download the Mono development packages from http://www.mono-project.com/downloads/.&lt;/fail&gt;<br />
                  &lt;/if&gt;<br />
                  &lt;property name=&quot;resgen.supportsexternalfilereferences&quot; value=&quot;false&quot; /&gt;<br />
                  &lt;property name=&quot;prefix&quot; value=&quot;${pkg-config::get-variable('mono', 'prefix')}&quot; /&gt;<br />
                  &lt;property name=&quot;toolDirectory&quot; value=&quot;${path::combine(prefix, 'lib/mono/4.5')}&quot; /&gt;<br />
              &lt;/project&gt;<br />
              &lt;tasks&gt;<br />
                  &lt;task name=&quot;al&quot;&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;true&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;csc&quot;&gt;<br />
                      &lt;attribute name=&quot;exename&quot;&gt;mcs&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;langversion&quot;&gt;linq&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportspackagereferences&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportsnowarnlist&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportsdocgeneration&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportskeycontainer&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportskeyfile&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportsdelaysign&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportslangversion&quot;&gt;true&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;jsc&quot;&gt;<br />
                      &lt;attribute name=&quot;exename&quot;&gt;mjs&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;strict&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;vbc&quot;&gt;<br />
                      &lt;attribute name=&quot;exename&quot;&gt;vbnc&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;true&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;resgen&quot;&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;true&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;supportsexternalfilereferences&quot;&gt;true&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;delay-sign&quot;&gt;<br />
                      &lt;attribute name=&quot;exename&quot;&gt;sn&lt;/attribute&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;true&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;license&quot;&gt;<br />
                      &lt;attribute name=&quot;hascommandlinecompiler&quot;&gt;false&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
                  &lt;task name=&quot;ilasm&quot;&gt;<br />
                      &lt;attribute name=&quot;managed&quot;&gt;true&lt;/attribute&gt;<br />
                  &lt;/task&gt;<br />
              &lt;/tasks&gt;<br />
          &lt;/framework&gt;<br />
[/code]</p>
</li>
</ul>
<h3 id="second-option-build-from-source">second option: build from source</h3>
<p>The following commands might be just enough to install nant:</p>
<p>[code]<br />
git clone https://github.com/nant/nant.git<br />
cd nant<br />
make install MONO='mono --runtime=v4.0' prefix=/usr/local/ TARGET=mono-4.0<br />
[/code]</p>
<p>Notice the extra parameters trying to convince nant it should use .NET 4.</p>
<h2 id="apache2-modmono">apache2 mod_mono</h2>
<p>If you want to host ASP.NET websites with Apache, you can use mod_mono.</p>
<p>Prerequisites:</p>
<p>[code]<br />
apt-get install apache2-dev<br />
[/code]</p>
<p>Installation:</p>
<p>[code]<br />
git clone https://github.com/mono/mod_mono.git<br />
cd mod_mono<br />
./autogen.sh --prefix=/usr/local --with-mono-prefix=/usr/local<br />
make<br />
make install<br />
[/code]</p>
<p>Note that the module configuration is installed in <code>/etc/apache2/mod_mono.conf</code>. However, the <code>a2enmod</code> utility is looking for module configurations in the directory <code>/etc/apache2/mods-available</code>. If you want to use <code>a2enmod</code>, you should link <code>mod_mono.conf</code> inside the expected directory. Or, you can just include the module configuration inside your site configuration as needed. For example:</p>
<p>[code]<br />
&lt;VirtualHost *:80&gt;<br />
    ServerName my.site.that.runs.mono.com<br />
    DocumentRoot /var/www/<br />
    Include mod_mono.conf<br />
&lt;/VirtualHost&gt;<br />
[/code]</p>
<h2 id="gtksharp">gtksharp</h2>
<p>gtksharp is currently building against gtk3. If you need gtk2 support, you can checkout the latest tag that supports gtk2 and build that. You can also build both of them and install them side by side.</p>
<h3 id="gtk3">gtk3</h3>
<p>First the prerequisites:</p>
<p>[code]<br />
apt-get install libgtk-3-dev<br />
[/code]</p>
<p>And then the usual build:</p>
<p>[code]<br />
git clone https://github.com/mono/gtk-sharp.git<br />
cd gtk-sharp<br />
./autogen.sh --prefix=/usr/local<br />
make<br />
make install<br />
[/code]</p>
<h3 id="gtk2">gtk2</h3>
<p>Prerequisites:</p>
<p>[code]<br />
apt-get install libgtk2.0-dev libpango1.0-dev libglade2-dev<br />
[/code]</p>
<p>And the build (notice we’re building the tag 2.12.22):</p>
<p>[code]<br />
git clone https://github.com/mono/gtk-sharp.git gtk-sharp-2<br />
cd gtk-sharp-2<br />
git checkout 2.12.22<br />
./bootstrap-2.12 --prefix=/usr/local<br />
make<br />
make install<br />
[/code]</p>
<h2 id="vbnet">vb.net</h2>
<p>This one goes pretty fast:</p>
<p>[code]<br />
git clone https://github.com/mono/mono-basic.git<br />
cd mono-basic<br />
./configure --prefix=/usr/local<br />
make<br />
make install<br />
[/code]</p>
<h2 id="summary">Summary</h2>
<p>The above will give you mono (latest and greatest!) and more or less anything related to it. One thing that is missing is monodevelop, the IDE. Perhaps I’ll cover that in a future post, together with the programming language boo.</p>
