---
layout: post
title: WCF, JSON and the DateTime
date: 2011-07-20 20:18:00.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags: []
meta:
  restapi_import_id: 586b47d26eba1
  original_post_id: '61'
  _wp_old_slug: '61'
  _edit_last: '14213986'
  _publicize_job_id: '4017087789'
author:


  display_name: ngeor
  first_name: Nikolaos
  last_name: Georgiou
---
<p>I&#039;m playing with a WCF service that works with JSON. If you haven&#039;t done this already, it&#039;s fairly easy. In the web.config, make sure your service is using the webHttpBinding binding. Also you&#039;ll need an endpoint behavior that looks like this:</p>
<p>[code]<br />
&lt;endpointBehaviors&gt;<br />
  &lt;behavior name=&quot;MyBehavior&quot;&gt;<br />
    &lt;webHttp /&gt;<br />
  &lt;/behavior&gt;<br />
&lt;/endpointBehaviors&gt;<br />
[/code]</p>
<p>Also, you&#039;ll need to annotate your operation methods with an attribute that tells WCF to use JSON (otherwise it uses XML):</p>
<p>[code]<br />
[OperationContract]<br />
[WebInvoke(&lt;br /&gt;    Method = &quot;POST&quot;,&lt;br /&gt;    BodyStyle = WebMessageBodyStyle.Bare,&lt;br /&gt;    RequestFormat = WebMessageFormat.Json,&lt;br /&gt;    ResponseFormat = WebMessageFormat.Json)]<br />
[/code]</p>
<p>That&#039;s it.</p>
<p>I had some problems however with the DateTime type. Unfortunately JSON doesn&#039;t have a standard for dates so Microsoft chose <a href="http://msdn.microsoft.com/en-us/library/bb299886.aspx#intro_to_json_sidebarb" target="_blank">its own way</a>. Basically it looks like "/Date(1224043200000)/"; the number represents the count of milliseconds since <a href="http://en.wikipedia.org/wiki/Unix_epoch" target="_blank">epoch</a>.Â  So when you&#039;re consuming your service, you&#039;ll have to deserialize this format yourself. You can find some suggestions <a href="http://stackoverflow.com/questions/206384/how-to-format-a-json-date" target="_blank">here</a>, I picked the simple:</p>
<p>[code]<br />
new Date(parseInt(jsonDate.substr(6)))<br />
[/code]</p>
<p>So if the date is represented by the count of milliseconds since epoch, what happens with older dates? This gave me a headache today, trying to figure out why my service wasn&#039;t returning anything... I had forgotten some DateTime set to its default value, which in .NET is 0000-00-00 00:00... I wasn&#039;t getting any error message whatsoever so I was troubleshooting blindly and the date was the last place to look. Usually it&#039;s some object referencing some other object that shouldn&#039;t or something like that...</p>
<p>Another promising solution is to use the <a href="http://james.newtonking.com/pages/json-net.aspx" target="_blank">Json.NET library</a> which offers a custom date time formatting which is more human readable, but I didn&#039;t try it out, I just made sure all my dates where properly set.</p>
<p>Hope this helps.</p>
