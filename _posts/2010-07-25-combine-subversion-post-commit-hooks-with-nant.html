---
layout: post
title: Combine subversion post-commit hooks with NAnt
date: 2010-07-25 10:08:00.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags: []
meta:
  restapi_import_id: 586b47d26eba1
  original_post_id: '107'
  _wp_old_slug: '107'
  _edit_last: '14213986'
  _publicize_job_id: '4017279583'
author:


  display_name: ngeor
  first_name: Nikolaos
  last_name: Georgiou
---
<p>Subversion offers a mechanism called <a href="http://svnbook.red-bean.com/en/1.4/svn.ref.reposhooks.post-commit.html">post-commit</a> hook that allows an executable file to be run on the subversion server after a successful commit has been made. Since I host my own home server, containing both this website and my own subersion server, I thought I could use this mechanism to automatically update some files on the website when a commit has been made. For example, if I commit some changes on a web page template, it would be nice if it would automatically be updated on the website and also be packaged as a zip file for visitors of the site to download.</p>
<p>To make it a bit simpler at first, I want a post-commit hook on a repository that will get the latest version after the commit and copy certain files to a certain folder. From time to time, I would like to modify that list of files. Now, the executable that can be run in the post-commit hook can be an .exe or a .bat file. An .exe file doesn&#039;t seem right, because it&#039;s tedious to update an .exe file everytime I want to modify the list of files I want to copy. The batch file is a better alternative but, and this applies also to the .exe solution, being a hook it means that it will not live inside the repository. Therefore, I would have to modify the batch file separately before every commit that changes the list of files to be copied. And I will have to open up remote access of some sort to the hooks folder of the subversion server in order to do so. That doesn&#039;t seem right either. Wouldn&#039;t it be nice if my source code also describes the post-commit actions? So I need to find a way to bring the control of the post-commit actions inside my source tree. That&#039;s where I though I can use NAnt.</p>
<p>The idea is that the post-commit hook will be really minimal and do only the following actions:</p>
<ol>
<li>Create a temporary folder</li>
<li>Export the latest source code into the folder</li>
<li>Run NAnt specifying a special target name, e.g. postcommit</li>
<li>Delete the temporary folder</li>
</ol>
<p>And the real set of actions to be performed will be defined as a NAnt build script in the root of my source tree, using a predefined target name (e.g. postcommit). I find this approach more generic and powerful. In effect, we are converting our subversion server into a powerful tool that can do whatever NAnt allows: automatic build, automatic unit-testing and continuous integration, e-mail reports, backup, whatever. As long as you can specify it in a NAnt build file, the subversion server will run it.</p>
<p>This is how my post-commit hook looks like:</p>
<p>[code]<br />
REM Create Temp folder<br />
mkdir c:Temp<br />
cd C:Temp</p>
<p>REM Export source code into trunk folder<br />
&quot;C:Program FilesSubversionbinsvn&quot; export<br />
  --username myusername<br />
  --password mypassword<br />
  svn://svnhost/repository/trunk<br />
  trunk</p>
<p>REM Go into trunk folder<br />
cd C:Temptrunk</p>
<p>REM Run NAnt<br />
&quot;C:Program Filesnant-0.90binnant&quot; postcommit</p>
<p>REM Cleanup<br />
cd C:Temp<br />
del /f /q/ s trunk<br />
rmdir /q /s trunk<br />
[/code]</p>
<p>and this is a sample of a NAnt file:</p>
<p>[code]<br />
&lt;?xml version=&quot;1.0&quot;?&gt;<br />
&lt;project name=&quot;demo&quot; default=&quot;postcommit&quot; basedir=&quot;.&quot;&gt;<br />
	&lt;description&gt;demo autodeploy script&lt;/description&gt;<br />
	&lt;property name=&quot;dest.dir&quot; value=&quot;C:/Web&quot; overwrite=&quot;false&quot; /&gt;<br />
	&lt;target name=&quot;postcommit&quot; description=&quot;&quot;&gt;<br />
		&lt;touch file=&quot;${dest.dir}/it_worked.txt&quot; /&gt;<br />
	&lt;/target&gt;<br />
&lt;/project&gt;<br />
[/code]</p>
<p>If you noticed the full paths in the post-commit batch file, that&#039;s because post-commit hooks run in an empty environment, which also means empty PATH variable. Also, it assumes that there&#039;s a trunk folder in your source tree and that folder contains a NAnt build file which has a target called postcommit. The trunk folder should exist, if you use the recommended root folder structure for the subversion repositories (trunk, branches, tags). So, if you copy the post-commit hook into the hooks folder of your repository on every commit NAnt will kick in and execute your custom actions. The sky is the limit! Hope this helps.</p>
