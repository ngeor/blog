---
layout: post
title: npm login credentials on the CI server
date: 2017-01-28 08:37:30.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Code
tags:
- continuous integration
- JavaScript
- npm
meta:
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '1244485619'
  _edit_last: '14213986'
author:


  display_name: ngeor
  first_name: Nikolaos
  last_name: Georgiou
---
<p>In a <a href="https://ngeor.wordpress.com/2016/08/20/automatic-versioning-of-npm-packages/">previous post</a>, I was discussing a way to publish an npm package to the public npm registry. A big prerequisite for that to work is that you have previously logged in to the CI server in order to authenticate against npm. But we can also fix that manual step and integrate it in the build.</p>
<p><!--more--></p>
<p>When you login to npm, a file <code>.npmrc</code> is generated and stored in your home directory. This file contains an authentication token. We're going to login to a regular developer's machine, generate that authentication token and then store it CI as a parameter. Defining a parameter in CI is something that typically requires far less privileges compared to a full shell login to the CI server itself.</p>
<p>First, login to npm with the <code>npm login</code> command. It goes like this typically:</p>
<p>[code]<br />
$ npm login<br />
Username: john.doe<br />
Password: ********<br />
Email: (this IS public) john.doe@company.com<br />
Logged in as john.doe on https://registry.npmjs.org/.<br />
[/code]</p>
<p>This generates the file we need, <code>.npmrc</code>, which looks like this:</p>
<p>[code]<br />
$ cat .npmrc<br />
//registry.npmjs.org/:_authToken=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx<br />
[/code]</p>
<p>The authentication token is basically a GUID that npm provides. If this file is present on another machine (e.g. the CI server), then you can publish to npm from that machine. This token should be therefore treated as a password, as far as security is concerned.</p>
<p>You don't even need access to the CI server or bother your OPS with that. Since the file format is very simple and straightforward, you can generate it on the fly during the build. Implement a build step that consists of this simple bash script:</p>
<p>[code]<br />
#!/bin/bash<br />
cat &lt; .npmrc<br />
//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN<br />
EOF<br />
[/code]</p>
<p>This script generates the <code>.npmrc</code> file, using the environment variable <code>NPM_AUTH_TOKEN</code>. All you have to do now is to define that environment variable in your build configuration.</p>
<p>&nbsp;</p>
